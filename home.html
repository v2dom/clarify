<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarify</title>
    <meta name="description" content="Unlock the full potential of your music experience with Clarify. Get insights into your listening habits on Spotify.">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/_next/static/css/d29eeda757dc16f6.css">
    <script defer src="/_next/static/chunks/webpack-cb7634a8b6194820.js"></script>
    <script defer src="/_next/static/chunks/main-4da6b05fc3579a91.js"></script>
</head>
<body>
    <h1>Welcome to Clarify</h1>
    <p>Fetching your Spotify data...</p>

    <script>
        // Function to get query parameters from the URL
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Function to remove 'code' from the URL after processing
        function removeQueryParam(param) {
            const url = new URL(window.location);
            url.searchParams.delete(param);
            window.history.replaceState({}, document.title, url);
        }

        // Handle Spotify Authorization Code
        window.onload = async function () {
            const authCode = getQueryParam("code");

            if (authCode) {
                console.log("Authorization Code:", authCode);

                // ðŸ”´ STEP 1: Send the authCode to your backend for token exchange
                try {
                    const response = await fetch("https://your-backend.com/api/spotify/token", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ code: authCode })
                    });

                    const data = await response.json();
                    if (data.access_token) {
                        console.log("Access Token:", data.access_token);

                        // ðŸ”µ STEP 2: Store token in localStorage (or use it immediately)
                        localStorage.setItem("spotify_access_token", data.access_token);

                        // ðŸ”µ STEP 3: Remove 'code' from URL
                        removeQueryParam("code");

                        // Redirect or load user data...
                    } else {
                        console.error("Error fetching access token:", data);
                    }
                } catch (error) {
                    console.error("Token Exchange Error:", error);
                }
            }
        };
    </script>
</body>
</html>
