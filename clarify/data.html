<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Spotify Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            text-align: center;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 50px auto;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        .data-list {
            list-style-type: none;
            padding: 0;
        }
        .list-item {
            margin: 10px 0;
            font-size: 1.2rem;
        }
        .list-item img {
            max-width: 50px;
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Your Top Spotify Data</h1>
        <p>Fetching your data...</p>
        <div id="top-artists-section">
            <h2>Your Top 10 Artists</h2>
            <ul id="top-artists" class="data-list"></ul>
        </div>
        <div id="top-tracks-section">
            <h2>Your Top 10 Tracks</h2>
            <ul id="top-tracks" class="data-list"></ul>
        </div>
    </div>

    <script>
        const CLIENT_ID = 'c0bf7f17b46b4433b09d1eda0f48af69';
        const CLIENT_SECRET = '27c98fdbd46d41f38ea0eb10a0cdfae1';
        const REDIRECT_URI = 'http://localhost:8888/callback';

        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');

        if (code) {
            const tokenUrl = 'https://accounts.spotify.com/api/token';
            const params = new URLSearchParams();
            params.append('grant_type', 'authorization_code');
            params.append('code', code);
            params.append('redirect_uri', REDIRECT_URI);
            params.append('client_id', CLIENT_ID);
            params.append('client_secret', CLIENT_SECRET);

            fetch(tokenUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: params.toString(),
            })
            .then(response => response.json())
            .then(data => {
                const accessToken = data.access_token;
                if (accessToken) {
                    fetchData(accessToken);
                } else {
                    console.error('Error: No access token received');
                }
            })
            .catch(error => console.error('Error exchanging code for token:', error));
        }

        function fetchData(accessToken) {
            fetch('https://api.spotify.com/v1/me/top/artists?limit=10', {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            })
            .then(response => response.json())
            .then(data => {
                const artistsList = document.getElementById("top-artists");
                artistsList.innerHTML = data.items.map(artist => `
                    <li class="list-item">
                        <img src="${artist.images[0]?.url || 'https://via.placeholder.com/50'}" alt="${artist.name}">
                        <span>${artist.name}</span>
                    </li>
                `).join('');
            })
            .catch(error => console.error('Error fetching top artists:', error));

            fetch('https://api.spotify.com/v1/me/top/tracks?limit=10', {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            })
            .then(response => response.json())
            .then(data => {
                const tracksList = document.getElementById("top-tracks");
                tracksList.innerHTML = data.items.map(track => `
                    <li class="list-item">
                        <span>${track.name} by ${track.artists.map(artist => artist.name).join(", ")}</span>
                    </li>
                `).join('');
            })
            .catch(error => console.error('Error fetching top tracks:', error));
        }
    </script>

</body>
</html>
