<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico">
    <title>Clarify</title>
    <meta name="description" content="Visualize your listening habits">
    <meta name="google-site-verification" content="fkQAjO-2VctZvh1Y6muJqRa__gA6Dr37Au_QdNOrYE0">


    <style>
        /* Include the custom styling for your app */
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
        }

        .container {
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .content {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-card {
            background-color: #1a1a1a;
            margin: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            width: 250px;
        }

        .stat-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #1db954; /* Spotify Green */
        }

        .stat-value {
            font-size: 1.5em;
            color: #fff;
        }
    </style>
</head>

<body>
    <h1>Spotify OAuth Callback</h1>
    <p id="message">Extracting the code...</p>

    <script>
        // This JavaScript will extract the 'code' parameter from the URL and send it to your backend
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');  // Get the authorization code from the URL

        if (code) {
            // Send the code to your backend server for exchange
            fetch('http://localhost:3000/callback?code=' + code)  // Adjust the backend URL if needed
                .then(response => response.text())
                .then(data => {
                    // Process the data returned from the backend (e.g., access token or error message)
                    document.getElementById('message').innerText = `Access Token: ${data}`;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('message').innerText = 'An error occurred while exchanging the code.';
                });
        } else {
            document.getElementById('message').innerText = 'No code found in URL.';
        }
    </script>

    <div class="container">
        <div class="header">
            <h1>Clarify</h1>
            <p>Visualize your listening habits</p>
        </div>

        <!-- Add your data here dynamically -->
        <div class="content">
            <div class="stat-card">
                <div class="stat-title">Total Listening Time</div>
                <div class="stat-value" id="listening-time">Loading...</div>
            </div>

            <div class="stat-card">
                <div class="stat-title">Top Artist</div>
                <div class="stat-value" id="top-artist">Loading...</div>
            </div>

            <div class="stat-card">
                <div class="stat-title">Top Track</div>
                <div class="stat-value" id="top-track">Loading...</div>
            </div>
        </div>
    </div>

    <script>
        // Example data fetch (replace with actual API calls)
        // This assumes you have an endpoint to fetch user data from Spotify
        async function fetchSpotifyData() {
            try {
                const response = await fetch('/api/spotify/data');  // Adjust this to your actual endpoint
                const data = await response.json();

                // Set the content dynamically
                document.getElementById('listening-time').innerText = data.listeningTime;
                document.getElementById('top-artist').innerText = data.topArtist;
                document.getElementById('top-track').innerText = data.topTrack;
            } catch (error) {
                console.error("Error fetching Spotify data: ", error);
            }
        }

        // Fetch the data once the page loads
        window.onload = fetchSpotifyData;
    </script>
</body>

</html>
